{"ast":null,"code":"import _objectSpread from \"/usr/src/app/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _slicedToArray from \"/usr/src/app/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/usr/src/app/app/src/contexts/auth.js\";\n\nimport React, { Component, useContext, useEffect, useState } from \"react\";\nimport { checkSession, createSession, deleteSession } from \"../apis/session\";\nimport { Redirect, useHistory, withRouter } from \"react-router-dom\";\nimport { createContext } from \"react\";\nimport { SnackbarContext } from \"./snackBar\";\nimport { CircularProgress, LinearProgress, Stack } from \"@mui/material\";\nimport { PageLoadingCircle } from \"../components/shared/commonPatrs\";\nimport { BadgeContext } from \"./badge\";\nimport { ConfigContext } from \"./config\";\nimport { InitialLoading } from \"../components/signin/initialLoading\";\nexport var AuthContext = createContext();\nvar initialState = {\n  loading: \"loading\",\n  loggedIn: false,\n  chief: false,\n  name: \"\"\n}; // const initialState = {\n//   loading: \"end\",\n//   loggedIn: true,\n//   chief: true,\n//   name: \"\"\n// }\n// -------------------login---------\n\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState(initialState),\n      _useState2 = _slicedToArray(_useState, 2),\n      state = _useState2[0],\n      setState = _useState2[1];\n\n  var history = useHistory();\n  var sb = useContext(SnackbarContext);\n  var badge = useContext(BadgeContext);\n  var orgConfig = useContext(ConfigContext);\n  console.log(orgConfig);\n\n  var login = function login(params) {\n    setState({\n      loading: \"initialLoading\"\n    });\n    createSession(params).then(function (res) {\n      switchLogin(res.data);\n      sb.setSnackBar({\n        open: true,\n        variant: \"success\",\n        content: \"\".concat(res.data.name, \"\\u3067\\u30ED\\u30B0\\u30A4\\u30F3\\u3057\\u307E\\u3057\\u305F\")\n      });\n    }).catch(function (e) {\n      console.log(e);\n\n      switch (e.response.status) {\n        case 401:\n          history.push(\"/login\");\n          sb.setSnackBar({\n            open: true,\n            variant: \"error\",\n            content: \"メールアドレスかパスワードが間違っています\"\n          });\n          break;\n\n        case 403:\n          history.push(\"/login\");\n          sb.setSnackBar({\n            open: true,\n            variant: \"error\",\n            content: \"すでにログインされています。\"\n          });\n          break;\n      }\n\n      setState({\n        loading: \"end\"\n      });\n    });\n  };\n\n  var logout = function logout() {\n    deleteSession().then(function (res) {\n      if (res.status == 200) {\n        history.push(\"/login\");\n        setState({\n          loggedIn: false,\n          loading: \"end\"\n        });\n        sessionStorage.clear();\n      }\n    });\n    sb.setSnackBar({\n      open: true,\n      variant: \"success\",\n      content: \"ログアウトしました\"\n    });\n  };\n\n  var sessionForbidden = function sessionForbidden() {\n    setState({\n      loggedIn: false,\n      loading: \"end\"\n    });\n    sessionStorage.clear();\n    sb.setSnackBar({\n      open: true,\n      variant: \"error\",\n      content: \"ログイン情報が確認できませんでした。\"\n    });\n  };\n\n  var switchLogin = function switchLogin(data) {\n    if (data.chief) {\n      initialSetting(data);\n      history.push(\"/Dashboard\");\n    } else {\n      setState({\n        loading: \"end\",\n        loggedIn: true,\n        name: data.name,\n        chief: data.chief\n      });\n      history.push(\"/employeeDashboard\");\n    }\n  };\n\n  var initialSetting = function initialSetting(data) {\n    setState(_objectSpread({}, state, {\n      loading: \"end\",\n      loggedIn: true,\n      name: data.name,\n      chief: data.chief\n    }));\n\n    if (!data.chief) {\n      return;\n    }\n\n    orgConfig.setParams(_objectSpread({}, data.config, {\n      orgName: data.orgName,\n      orgAddress: data.orgAddress\n    }));\n    badge.setBadge(data.badges);\n  };\n\n  useEffect(function () {\n    checkSession().then(function (res) {\n      initialSetting(res.data);\n    }).catch(function (e) {\n      console.log(e);\n\n      if (e.response.status === 403) {\n        sessionForbidden();\n      } else {\n        throw e;\n      }\n    });\n  }, []);\n\n  var SwitchRender = function SwitchRender() {\n    switch (state.loading) {\n      case \"loading\":\n        return /*#__PURE__*/React.createElement(PageLoadingCircle, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 162,\n            columnNumber: 16\n          }\n        });\n\n      case \"end\":\n        return children;\n\n      case \"initialLoading\":\n        return /*#__PURE__*/React.createElement(InitialLoading, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 16\n          }\n        });\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(AuthContext.Provider, {\n    value: {\n      state: state,\n      setState: setState,\n      login: login,\n      logout: logout,\n      sessionForbidden: sessionForbidden\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(SwitchRender, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }\n  }));\n};","map":{"version":3,"names":["React","Component","useContext","useEffect","useState","checkSession","createSession","deleteSession","Redirect","useHistory","withRouter","createContext","SnackbarContext","CircularProgress","LinearProgress","Stack","PageLoadingCircle","BadgeContext","ConfigContext","InitialLoading","AuthContext","initialState","loading","loggedIn","chief","name","AuthProvider","children","state","setState","history","sb","badge","orgConfig","console","log","login","params","then","res","switchLogin","data","setSnackBar","open","variant","content","catch","e","response","status","push","logout","sessionStorage","clear","sessionForbidden","initialSetting","setParams","config","orgName","orgAddress","setBadge","badges","SwitchRender"],"sources":["/usr/src/app/app/src/contexts/auth.js"],"sourcesContent":["import React, { Component, useContext, useEffect, useState } from \"react\";\r\nimport { checkSession, createSession, deleteSession } from \"../apis/session\";\r\nimport { Redirect, useHistory, withRouter } from \"react-router-dom\";\r\nimport { createContext } from \"react\";\r\nimport { SnackbarContext } from \"./snackBar\";\r\nimport { CircularProgress, LinearProgress, Stack } from \"@mui/material\";\r\nimport { PageLoadingCircle } from \"../components/shared/commonPatrs\";\r\nimport { BadgeContext } from \"./badge\";\r\nimport { ConfigContext } from \"./config\";\r\nimport { InitialLoading } from \"../components/signin/initialLoading\";\r\n\r\nexport const AuthContext = createContext()\r\n\r\nconst initialState = {\r\n  loading: \"loading\",\r\n  loggedIn: false,\r\n  chief: false,\r\n  name: \"\"\r\n}\r\n\r\n\r\n// const initialState = {\r\n//   loading: \"end\",\r\n//   loggedIn: true,\r\n//   chief: true,\r\n//   name: \"\"\r\n// }\r\n\r\n\r\n// -------------------login---------\r\n\r\nexport const AuthProvider = ({children}) => {\r\n\r\n  const [state, setState] = useState(initialState);\r\n  const history = useHistory();\r\n\r\n  const sb = useContext(SnackbarContext);\r\n  const badge = useContext(BadgeContext);\r\n  const orgConfig = useContext(ConfigContext);\r\n  console.log(orgConfig)\r\n  \r\n    const login = (params) =>{\r\n        setState({loading: \"initialLoading\"})\r\n        createSession(params)\r\n        .then(res => {\r\n           switchLogin(res.data)\r\n           sb.setSnackBar({\r\n            open: true,\r\n            variant: \"success\",\r\n            content: `${res.data.name}でログインしました`\r\n          })\r\n          }\r\n        )\r\n        .catch((e) => {\r\n          console.log(e)\r\n          switch(e.response.status){\r\n          case 401:\r\n            history.push(\"/login\")\r\n            sb.setSnackBar({\r\n              open: true,\r\n              variant: \"error\",\r\n              content: \"メールアドレスかパスワードが間違っています\"\r\n            })\r\n            break\r\n          case 403:\r\n            history.push(\"/login\")\r\n            sb.setSnackBar({\r\n              open: true,\r\n              variant: \"error\",\r\n              content: \"すでにログインされています。\"\r\n            })\r\n            break\r\n          }\r\n          setState({loading: \"end\"})\r\n        })\r\n\r\n    }\r\n\r\n     const logout = () => {\r\n        deleteSession()\r\n        .then(res => {\r\n          if(res.status == 200)\r\n            {\r\n            history.push(\"/login\")\r\n            setState({\r\n              loggedIn: false,\r\n              loading: \"end\"})\r\n            sessionStorage.clear()\r\n           }\r\n        }\r\n        )\r\n        sb.setSnackBar({\r\n          open: true,\r\n          variant: \"success\",\r\n          content: \"ログアウトしました\"\r\n        })\r\n    }\r\n\r\n    const sessionForbidden = () => {\r\n      setState({\r\n        loggedIn:false,\r\n        loading: \"end\"})\r\n      sessionStorage.clear()\r\n      sb.setSnackBar({\r\n        open: true,\r\n        variant: \"error\",\r\n        content: \"ログイン情報が確認できませんでした。\"\r\n      })\r\n    }\r\n\r\n    const switchLogin = (data) => {\r\n      if(data.chief){\r\n        initialSetting(data)\r\n        history.push(\"/Dashboard\")\r\n      }else{\r\n        setState({\r\n          loading: \"end\",\r\n          loggedIn: true,\r\n          name: data.name,\r\n          chief: data.chief})\r\n        history.push(\"/employeeDashboard\")\r\n      }\r\n\r\n    }\r\n\r\n    const initialSetting = (data) => {\r\n      setState({...state,\r\n        loading: \"end\",\r\n        loggedIn: true,\r\n        name: data.name,\r\n        chief: data.chief\r\n      }) \r\n      if(!data.chief){return}\r\n      orgConfig.setParams({\r\n        ...data.config,\r\n        orgName: data.orgName,\r\n        orgAddress: data.orgAddress\r\n      })\r\n      badge.setBadge(data.badges)\r\n\r\n    }\r\n\r\n      \r\n  useEffect(() => {\r\n    checkSession()\r\n    .then(res => {\r\n      initialSetting(res.data)\r\n    })\r\n    .catch((e) => {\r\n      console.log(e)\r\n      if (e.response.status === 403) {\r\n       sessionForbidden()\r\n      } else {\r\n        throw e;\r\n      }\r\n    })\r\n  },[])\r\n\r\n  const SwitchRender = () => {\r\n    switch(state.loading){\r\n      case \"loading\":\r\n        return <PageLoadingCircle/>\r\n      case \"end\":\r\n       return children\r\n      case \"initialLoading\":\r\n        return <InitialLoading/>\r\n      }\r\n  }\r\n\r\n    return (\r\n      <AuthContext.Provider value={{\r\n        state: state,\r\n        setState: setState,\r\n        login: login,\r\n        logout: logout,\r\n        sessionForbidden: sessionForbidden\r\n      }}>\r\n        <SwitchRender/>      \r\n      </AuthContext.Provider>\r\n\r\n    )\r\n  }\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}